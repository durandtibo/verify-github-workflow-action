name: "Verify GitHub Workflows"
description: "Verify the GitHub Workflows using actionlint"

author: "Thibaut Durand"

branding:
  icon: "check-circle"
  color: "blue"

inputs:
  paths:
    description: >
      Paths or glob patterns to workflow files.
      Defaults to `.github/workflows/*`
    required: false
    default: ".github/workflows/*"

  version:
    description: "Version of actionlint to install (default: latest)"
    required: false
    default: "latest"

  flags:
    description: "Additional flags to pass to actionlint"
    required: false
    default: ""

runs:
  using: "composite"
  steps:
    # Download and install actionlint using the official installer script
    - name: Install actionlint
      shell: bash
      run: |
        set -euo pipefail
        echo "ðŸ“¦ Installing actionlint ${{ inputs.version }}..."

        ACTIONLINT_URL="https://raw.githubusercontent.com/rhysd/actionlint/main/scripts/download-actionlint.bash"
        bash <(curl -sSL "$ACTIONLINT_URL") ${{ inputs.version }}

        # Move to a location in PATH for easier access
        sudo mv ./actionlint /usr/local/bin/actionlint || mv ./actionlint "$HOME/.local/bin/actionlint" || true

    # Verify that actionlint was installed correctly
    - name: Verify actionlint installation
      shell: bash
      run: |
        if command -v actionlint &> /dev/null; then
          echo "âœ… actionlint installed successfully"
          actionlint --version
        elif [ -f ./actionlint ]; then
          echo "âœ… actionlint available in current directory"
          ./actionlint --version
        else
          echo "âŒ actionlint installation failed"
          exit 1
        fi

    # Run actionlint against workflow files
    - name: Run actionlint on workflow files
      shell: bash
      run: |
        set -euo pipefail
        echo "ðŸ” Running actionlint on GitHub workflows..."

        # Use actionlint from PATH if available, otherwise use local copy
        if command -v actionlint &> /dev/null; then
          ACTIONLINT_CMD="actionlint"
        else
          ACTIONLINT_CMD="./actionlint"
        fi

        # Run actionlint with specified paths and any additional flags
        $ACTIONLINT_CMD ${{ inputs.flags }} ${{ inputs.paths }}

        echo "âœ… All workflows verified successfully!"
