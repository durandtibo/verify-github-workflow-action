name: "Verify GitHub Workflows"
description: "Verify the GitHub Workflows using actionlint"

author: "Thibaut Durand"

branding:
  icon: "check-circle"
  color: "blue"

inputs:
  paths:
    description: >
      Paths or glob patterns to workflow files.
      Defaults to `.github/workflows/*`
    required: false
    default: ".github/workflows/*"

  version:
    description: "Version of actionlint to install (default: latest)"
    required: false
    default: "latest"

  flags:
    description: "Additional flags to pass to actionlint"
    required: false
    default: ""

runs:
  using: "composite"
  steps:
    # Download and install actionlint using the official installer script
    - name: Install actionlint
      shell: bash
      run: |
        set -euo pipefail
        echo "ðŸ“¦ Installing actionlint ${{ inputs.version }}..."

        ACTIONLINT_URL="https://raw.githubusercontent.com/rhysd/actionlint/main/scripts/download-actionlint.bash"
        bash <(curl -sSL "$ACTIONLINT_URL") ${{ inputs.version }}

    # Verify that actionlint was installed correctly
    - name: Verify actionlint installation
      shell: bash
      run: |
        set -euo pipefail
        if [ -f ./actionlint ]; then
          echo "âœ… actionlint installed successfully"
          ./actionlint --version
        else
          echo "âŒ actionlint installation failed"
          exit 1
        fi

    # Run actionlint against workflow files
    - name: Run actionlint on workflow files
      shell: bash
      run: |
        set -euo pipefail
        echo "ðŸ” Running actionlint on GitHub workflows..."

        ./actionlint ${{ inputs.flags }} ${{ inputs.paths }}

        echo "âœ… All workflows verified successfully!"
